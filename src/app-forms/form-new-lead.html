<link rel="import" href="/bower_components/polymer/polymer-element.html">
<script src="/bower_components/webcomponentsjs/webcomponents-lite.js"></script>

<!---->
<link rel="import" href="/src/app-main/app-methods.html">
<link rel="import" href="/src/app-view/app-item.html">
<link rel="import" href="/src/custom-elements/paper-item-zip/paper-item-zip.html">
<!---->

<dom-module id="form-new-lead">
  <template>
    <style include="paper-item-styles">
      .buttons {
        text-align: end;
      }

      .primary {
        background-color: var(--primary-color);
        color: white;
      }
    </style>
    <app-methods id="methods"></app-methods>
    
    <app-item type="header"
              label="New lead"
              >
    </app-item>
    <!---->
    <paper-icon-item>
      <paper-ripple></paper-ripple>
      <!---->
      <div class="avatar xblue" slot="item-icon">
        <paper-icon-button icon="vaadin:user" alt="inbox"></paper-icon-button>
      </div>
      <!---->
      <paper-item-body xtwo-line>
        <paper-input label="Name" value="{{item.name}}"></paper-input>
        <!--- ->
        <div secondary>Jan 9, 2014</div>
        <!---->
      </paper-item-body>
      <!--- ->
      <paper-icon-button icon="star" alt="favourite this!"></paper-icon-button>
      <!--- ->
      <div>0/2</div>
      <!---->
    </paper-icon-item>
    
    <paper-item-zip></paper-item-zip>

    <paper-icon-item>
      <paper-ripple></paper-ripple>
      <!---->
      <div class="avatar xblue" slot="item-icon">
        <paper-icon-button icon="vaadin:map-marker" alt="inbox"></paper-icon-button>
      </div>
      <!---->
      <paper-item-body xtwo-line>
        <paper-input label="Zip code" value="{{item.zip}}"></paper-input>
        <!--- ->
        <div secondary>Jan 9, 2014</div>
        <!---->
      </paper-item-body>
      <!--- ->
      <paper-icon-button icon="star" alt="favourite this!"></paper-icon-button>
      <!--- ->
      <div>0/2</div>
      <!---->
    </paper-icon-item>

    <paper-icon-item>
      <paper-ripple></paper-ripple>
      <!---->
      <div class="avatar xblue" slot="item-icon">
        <paper-icon-button icon="vaadin:phone" alt="inbox"></paper-icon-button>
      </div>
      <!---->
      <paper-item-body xtwo-line>
        <paper-input label="Phone" value="{{item.phone}}"></paper-input>
        <!--- ->
        <div secondary>Jan 9, 2014</div>
        <!---->
      </paper-item-body>
      <!--- ->
      <paper-icon-button icon="star" alt="favourite this!"></paper-icon-button>
      <!--- ->
      <div>0/2</div>
      <!---->
    </paper-icon-item>
    <paper-icon-item>
      <paper-ripple></paper-ripple>
      <!---->
      <div class="avatar xblue" slot="item-icon">
        <paper-icon-button icon="communication:email" alt="inbox"></paper-icon-button>
      </div>
      <!---->
      <paper-item-body xtwo-line>
        <paper-input label="Email" value="{{item.email}}"></paper-input>
        <!--- ->
        <div secondary>Jan 9, 2014</div>
        <!---->
      </paper-item-body>
      <!--- ->
      <paper-icon-button icon="star" alt="favourite this!"></paper-icon-button>
      <!--- ->
      <div>0/2</div>
      <!---->
    </paper-icon-item>

    <dashboard-detail-type></dashboard-detail-type>

    <paper-item class="buttons">
      <!--- ->
        <div class="avatar xblue" slot="item-icon">
          <paper-icon-button icon="vaadin:warning" alt="inbox"></paper-icon-button>
        </div>
      <!---->
      <paper-item-body xtwo-line>
        <div>
          <paper-button on-tap="_tappedCancel">Cancel</paper-button>
          <paper-button on-tap="_tappedSave" autofocus class="primary">Save</paper-button>
        </div>
      </paper-item-body>
      <!--- ->
      <paper-icon-button icon="star" alt="favourite this!"></paper-icon-button>
      <!--- ->
      <div>0/2</div>
      <!---->
    </paper-item>
    
		
	</template>

  <script>
    class FormNewLead extends Polymer.Element {
      static get is() { return 'form-new-lead'; }

      static get properties() { return {
				item: {
					type: Object,
					notify: true,
          value: () => ({}),
					// observer: '_itemChanged',
				},
			}}
			
			constructor() {
				super();
			}
			
			// ready() {
      //   super.ready();
      //   window.addEventListener('user-action-select', (e) => this.onUserActionSelect(e));
      // }
			
			// _itemChanged(o) {
			// 	console.log('item', o);
			// }

      _tappedCancel() {
        this._resetItem();
        this._dispatchCloseDialog();
      }
			
      _tappedSave() {
        const data = this.item;
        this._save(data);
        this._dispatchCloseDialog();
        this._resetItem();
      }

      _save(r) {
        const data = r || this.item;
				const entity = 'lead-sent';
				//const entity = [ XFIX, label, ].join('-'); // 'user-switch-mortgage'
				//const name = ['update', entity].join('-');
				
				const methods = this.$.methods;
				// detail = {method: 'save'|'delete', entity: 'deal'|'bid'|'network', data: {new:'data'}}
				const method = 'save'; // 'save'|'delete'
				//const entity = 'user-switch'; // 'zip'|'deal'|'bid'|'network'
				const detail = {
					method: method,
					entity: entity,
					data: data,
				};
        console.log('detail\n', detail);
				methods.method(detail);

        // new Promise().then()
        // this._resetItem();       
      }

      _resetItem() {
        this.set('item', {});
      }

      _dispatchEvent(name, data) {
			  const n = name;
			  const o = {
			    bubbles: true,
			   	composed: true,
			   	detail: data,
			  };
			  // console.log('o\n', o);
			  const d = new CustomEvent(n, o);
			  //console.log('d\n', d);
			  this.dispatchEvent(d);				
      }

      // _dispatchSaveItem() {
      //   // at present time (june 2018), we will decentralize save operations by policy
      //   // this preserves and facilitates maximum flexibility in the save method at each node
      //   // therefore, do not dispatch an event
      // }

      _dispatchCloseDialog() {
        // this._dispatchEvent(name, data);
        this._dispatchEvent('close-dialog');
      }
		
		}

    window.customElements.define(FormNewLead.is, FormNewLead);
  </script>
</dom-module>
